{% extends 'base.html' %}
{% block content %}
<h1>Create Sale Order</h1>
<h1>Create Sale Order</h1>
<form method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="button" id="add-product-button">+ Add Sale Order Product</button>
    <div id="product-section">
        <!-- Sale order product items will be added here -->
    </div>

    <input type="submit" value="Save">
</form>

<!-- Add Product Modal -->
<div id="add-product-modal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Add Sale Order Product</h2>
        <form id="add-product-form">
            <!-- Fields for adding a new product -->
            <select name="product">
                <option value="">Select a product</option>
                {% for product in products %}
                    <option value="{{ product.id }}">{{ product.name }}</option>
                {% endfor %}
            </select>
            <input type="number" name="quantity" placeholder="Quantity" min="1">
            <input type="button" value="Add" id="add-product-to-sale-order">
        </form>
    </div>
</div>

<script>
    // JavaScript to handle the modal for adding sale order products
    $(document).ready(function () {
        const productSection = $('#product-section');
        const addProductButton = $('#add-product-button');
        const addProductModal = $('#add-product-modal');
        const closeAddProductModal = addProductModal.find('.close');
        const addProductForm = $('#add-product-form');
        const addProductToSaleOrderButton = $('#add-product-to-sale-order');

        addProductButton.on('click', function () {
            addProductModal.css('display', 'block');
        });

        closeAddProductModal.on('click', function () {
            addProductModal.css('display', 'none');
        });

        addProductToSaleOrderButton.on('click', function () {
            // Get product and quantity from the modal form
            const product = addProductForm.find('select[name="product"]').val();
            const quantity = addProductForm.find('input[name="quantity"]').val();

            // Create a new sale order product item and append it to the product section
            const productHtml = `
                <div class="product-item">
                    <select name="product_quantities[${productIndex}][product]">
                        <option value="${product}">${addProductForm.find('select[name="product"] option:selected').text()}</option>
                    </select>
                    <input type="number" name="product_quantities[${productIndex}][quantity]" value="${quantity}" min="1">
                </div>
            `;
            productSection.append(productHtml);
            productIndex++;

            // Close the modal
            addProductModal.css('display', 'none');
        });
    });
</script>
{% endblock %}